<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Piedra, Papel o Tijeras - Multijugador</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #222;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #status {
            margin-bottom: 10px;
            font-weight: bold;
        }
        button {
            font-size: 20px;
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            background-color: #0b79d0;
            color: white;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        #resultado, #puntos, #rondas {
            margin-top: 15px;
            font-size: 1.2em;
        }
        #salirBtn {
            margin-top: 20px;
            background-color: #d03a3a;
        }
        input {
            font-size: 18px;
            padding: 5px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Piedra, Papel o Tijeras - Multijugador</h1>

    <div id="loginDiv">
        <input type="text" id="usernameInput" placeholder="Tu nombre" />
        <button id="btnUnirse">Unirse a la sala</button>
    </div>

    <div id="gameDiv" style="display:none;">
        <div id="status">Esperando jugadores...</div>

        <div>
            <button onclick="jugar('piedra')" id="btnPiedra" disabled>Piedra</button>
            <button onclick="jugar('papel')" id="btnPapel" disabled>Papel</button>
            <button onclick="jugar('tijeras')" id="btnTijeras" disabled>Tijeras</button>
        </div>

        <div id="resultado"></div>
        <div id="puntos"></div>
        <div id="rondas"></div>

        <button id="salirBtn">Salir de la sala</button>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script>
        let socket;
        let username = null;
        let enSala = false;

        const loginDiv = document.getElementById('loginDiv');
        const gameDiv = document.getElementById('gameDiv');
        const statusDiv = document.getElementById('status');
        const resultadoDiv = document.getElementById('resultado');
        const puntosDiv = document.getElementById('puntos');
        const rondasDiv = document.getElementById('rondas');
        const btnUnirse = document.getElementById('btnUnirse');
        const usernameInput = document.getElementById('usernameInput');
        const btnPiedra = document.getElementById('btnPiedra');
        const btnPapel = document.getElementById('btnPapel');
        const btnTijeras = document.getElementById('btnTijeras');
        const salirBtn = document.getElementById('salirBtn');

        // Cambia esta URL por la de tu servidor en Render o donde esté alojado
        const SERVER_URL = 'https://ppt-multijugador.onrender.com';

        btnUnirse.onclick = () => {
            username = usernameInput.value.trim();
            if (!username) {
                alert('Por favor ingresa un nombre válido.');
                return;
            }
            iniciarConexion();
        };

        salirBtn.onclick = () => {
            if (!enSala) return;
            socket.emit('salir', { username });
            resetJuego();
        };

        function iniciarConexion() {
            socket = io(SERVER_URL);

            socket.on('connect', () => {
                socket.emit('unirse', { username });
                statusDiv.textContent = 'Conectando...';
            });

            socket.on('mensaje', msg => {
                statusDiv.textContent = msg;
            });

            socket.on('start', msg => {
                statusDiv.textContent = msg;
                habilitarBotones(true);
                enSala = true;
            });

            socket.on('resultado', data => {
                resultadoDiv.textContent = data.texto;
                puntosDiv.textContent = 'Puntos: ' + JSON.stringify(data.puntos);
                rondasDiv.textContent = 'Rondas jugadas: ' + data.rondas;
                habilitarBotones(true);
            });

            socket.on('disconnect', () => {
                statusDiv.textContent = 'Desconectado del servidor.';
                habilitarBotones(false);
                enSala = false;
            });

            loginDiv.style.display = 'none';
            gameDiv.style.display = 'block';
        }

        function jugar(opcion) {
            habilitarBotones(false);
            resultadoDiv.textContent = 'Esperando al otro jugador...';
            socket.emit('jugada', { username, jugada: opcion });
        }

        function habilitarBotones(activo) {
            btnPiedra.disabled = !activo;
            btnPapel.disabled = !activo;
            btnTijeras.disabled = !activo;
            salirBtn.disabled = !activo;
        }

        function resetJuego() {
            username = null;
            enSala = false;
            socket.disconnect();
            loginDiv.style.display = 'block';
            gameDiv.style.display = 'none';
            resultadoDiv.textContent = '';
            puntosDiv.textContent = '';
            rondasDiv.textContent = '';
            statusDiv.textContent = '';
            usernameInput.value = '';
            habilitarBotones(false);
        }
    </script>
</body>
</html>
